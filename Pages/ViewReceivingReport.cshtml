@page
@model LabMaterials.Pages.ViewReceivingReportModel
@{
    ViewData["Title"] = "View Receiving Reports";
}

<style>
    .nested-table td th {
        border:none;
    }
</style>


<div class="d-block mb-4 mb-md-0">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent p-2 mb-0">
            <li class="breadcrumb-item d-flex align-items-center">
                <img src="images/home.png" alt="Home" width="16" height="16" class="me-2" />
                <a href="/Home" class="text-decoration-none">@Model.lblHome</a>
            </li>
            <li class="breadcrumb-item d-flex align-items-center">
                <img src="images/inventory.png" alt="Home" width="16" height="16" class="me-2" />
                        
                <a href="/Requests" class="text-decoration-none">@Model.lblRequests</a>
            </li>
            <li class="breadcrumb-item d-flex align-items-center">
                <img src="images/inventory.png" alt="Home" width="16" height="16" class="me-2" />
                 @ViewData["Title"]
            </li>

        </ol>
    </nav>

    <h1 class="h4">@ViewData["Title"]</h1>
</div>



<div>
    @if (Model.Report != null)
    {
        var report = Model.Report;
        <div class="card mb-4 border shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <strong>Receiving Report - Serial No: @report.SerialNumber</strong>
                <div>
                    @* <a asp-page="/EditReceivingReport" asp-route-id="@report.Id" class="btn btn-sm btn-warning me-2">Edit</a> *@
                    @* <a asp-page="/PrintReceivingReport" asp-route-id="@report.Id" class="btn btn-sm btn-secondary">Print</a> *@
                    
                    <button id="PrintReport" class="btn btn-primary" >Print Test</button>

                </div>
            </div>
            <div class="card-body">
                @* <div>
                    <p>Approval Status</p>
                    <p>Technical Member: @report.TechnicalMemberApproval</p>
                    @if(Model.GeneralSupervisor != null){
                        <p>General Supervisor: @report.TechnicalMemberApproval</p>

                    }
                    
                </div> *@

                <dl class="row">
                    <dt class="col-sm-3">Fiscal Year</dt>
                    <dd class="col-sm-3">@report.FiscalYear</dd>

                    <dt class="col-sm-3">Receiving Date</dt>
                    <dd class="col-sm-3">@report.ReceivingDate.ToString("yyyy-MM-dd")</dd>

                    <dt class="col-sm-3">Recipient Sector</dt>
                    <dd class="col-sm-3">@report.RecipientSector</dd>

                    <dt class="col-sm-3">Sector No.</dt>
                    <dd class="col-sm-3">@report.SectorNumber</dd>
                    
                    
                    <dt class="col-sm-3">Receiving Warehouse</dt>
                    <dd class="col-sm-3">@Model.ReceivingWarehouse</dd>

                    <dt class="col-sm-3">Based On Document</dt>
                    <dd class="col-sm-3">@report.BasedOnDocument</dd>

                    <dt class="col-sm-3">Document No.</dt>
                    <dd class="col-sm-3">@report.DocumentNumber</dd>

                    <dt class="col-sm-3">Document Date</dt>
                    <dd class="col-sm-3">@report.DocumentDate.ToString("yyyy-MM-dd")</dd>

                    <dt class="col-sm-3">Supplier Type</dt>
                    <dd class="col-sm-3">@report.Supplier?.SupplierType</dd>

                    <dt class="col-sm-3">Supplier</dt>
                    <dd class="col-sm-3">@report.Supplier?.SupplierName</dd>
                    
                    <dt class="col-sm-3">Receipient</dt>
                    <dd class="col-sm-3">@Model.ReceipientManager</dd>

                    <dt class="col-sm-3">Technical Member</dt>
                    <dd class="col-sm-3">@Model.TechnicalMember</dd>

                    <dt class="col-sm-3">General Supervisor</dt>
                        @if(Model.GeneralSupervisor != null){
                            <dd class="col-sm-3">@Model.GeneralSupervisor</dd>
                        }
                        else
                        { <dd class="col-sm-3">  none</dd>
                        }

                </dl>


                <table class="table table-bordered table-striped" style="width: 826px;">
                    <thead>
                        <tr>
                            <th>Comments</th>
                            <th>Item Name</th>
                            <th>Item Quantity</th>
                            <th>Unit Price</th>
                            <th>Total Price</th>
                        </tr>
                    </thead>
                    <tbody id="itemsTableBody">
                        @foreach(var item in Model.ReceivingItems){
                            var ItemName = Model.Items.FirstOrDefault(i => i.ItemId == item.ItemId)?.   ItemName ?? "";

                            <tr>
                                <td>@item.Comments</td>
                                <td>@ItemName</td>
                                <td>@item.Quantity</td>
                                <td>@item.UnitPrice</td>
                                <td>@(item.Quantity * item.UnitPrice)</td>

                            </tr>

                        }
                   
                    </tbody>
                </table>

            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">No receiving report available.</div>
    }
</div>

<div id="printArea" style="display: none;">
    <table class="table-format border"" align="center"  id="printArea" style="width: 826px;"  dir="@Model.dir">
        <tr>
            <td colspan="10">
                <div align="center" style=" margin-top: 20px; margin-bottom: 40px; font-weight: bold;">
                   @Model.lblReceivingItems
                </div>
                @{
                    var rep = Model.Report;
                }
                <table class="nested-table" border="0" width="100%">
                    <tr >
                        <td style="width: 15%;border: none;">@Model.lblSerialNo</td>
                        <td style="width: 15%;border: none;">@rep.SerialNumber</td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;" align="center">@Model.lblSupplierName</td>
                        <td style="width: 15%;border: none;">@rep.Supplier?.SupplierName</td>
                        <td style="width: 15%;border: none;" align="right">@Model.lblRecipientSector</td>
                        <td style="width: 15%;border: none;">@rep.RecipientSector</td>
                    </tr>
                    <tr>
                        <td style="width: 15%;border: none;">@Model.lblPageCount</td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;" align="right">@Model.lblSectorNo</td>
                        <td style="width: 15%;border: none;">@rep.SectorNumber</td>
                    </tr>
                    <tr>
                        <td style="width: 15%;border: none;">@Model.lblDateOfReceipt</td>
                        <td style="width: 15%;border: none;">@rep.ReceivingDate.ToString("yyyy-MM-dd")</td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;"></td>
                        <td style="width: 15%;border: none;" align="right">@Model.lblRecipientWarehouse</td>
                        <td style="width: 15%;border: none;">@Model.ReceivingWarehouse</td>
                    </tr>
                    <tr>
                        <td style="width: 15%;border: none;">Fiscal Year</td>
                        <td style="width: 15%;border: none;">@rep.FiscalYear</td>
                        <td style="width: 15%;border: none;" align="center">Document Date</td>
                        <td style="width: 15%;border: none;">@rep.DocumentDate.ToString("yyyy-MM-dd")</td>
                        <td style="width: 15%;border: none;" align="center">Document No.</td>
                        <td style="width: 15%;border: none;">@rep.DocumentNumber</td>
                        <td style="width: 15%;border: none;" align="right">Based On Document</td>
                        <td style="width: 15%;border: none;">@rep.BasedOnDocument</td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <th style="width: 25%;" rowspan="2">Comments</th>
            <th style="width: 7%;" colspan="2">Unit Price</th>
            <th style="width: 7%;" colspan="2">Total Price</th>
            <th style="width: 3%;" rowspan="2">Quantity</th>
            <th style="width: 3%;" rowspan="2">Unit Of Measure</th>
            <th style="width: 10%;" rowspan="2">Item Name-Description</th>
            <th style="width: 5%;" rowspan="2">Item No</th>
            <th style="width: 5%;" rowspan="2">Count</th>
        </tr>
        <tr>
            <td style="width: 3.5%; text-align: center;">SAR</td>
            <td style="width: 3.5%; text-align: center;"></td>
            <td style="width: 3.5%; text-align: center;">SAR</td>
            <td style="width: 3.5%; text-align: center;"></td>
        </tr>
        @foreach(var item in Model.ReceivingItems){
            var Item = Model.Items.FirstOrDefault(i => i.ItemId == item.ItemId);      
            var UnitMeasure = Model.Units.FirstOrDefault(u => u.Id == Item.UnitId).UnitCode ?? "";;
            <tr>
                <td>@item.Comments</td>
                <td>@item.UnitPrice</td>
                <td></td>
                <td>@(item.Quantity * item.UnitPrice)</td>
                <td>&nbsp;</td>
                <td>@item.Quantity</td>
                <td>@UnitMeasure</td>
                <td>@Item.ItemName- @Item.ItemDescription</td>
                <td>@Item.ItemCode</td>
                <td>&nbsp;</td>
            </tr>
        }
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td colspan="7">Total Price</td>
        </tr>

       
       
      
       
        <tr>
            <td colspan="2" style=" text-align: center;"><b>Chief Responsible</b></td>
            <td colspan="4" style="text-align: center;"><b>Technical Member</b></td>
            <td colspan="3" style="text-align: center;"><b>Recipient</b></td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td rowspan="2" colspan="2" style="text-align: center;"></td>
            <td colspan="4">&nbsp;</td>
            <td colspan="3">&nbsp;</td>
            <td style=" text-align: center;">Name<br>Signature<br>Date</td>
        </tr>
    </table>
</div>

@* <div id="printArea" style="display: none;">
     <h2 style="text-align: center;">Receiving Report</h2>

  <!-- Header Section -->
  <table style="width: 100%; border: 1px solid #000; border-collapse: collapse; margin-bottom: 10px;">
    <tr>
      <td style="border: 1px solid #000; padding: 6px;">Serial Number</td>
      <td style="border: 1px solid #000; padding: 6px;">Pages Count</td>
      <td style="border: 1px solid #000; padding: 6px;">Date of Receipt</td>
      <td style="border: 1px solid #000; padding: 6px;">Fiscal Year</td>
    </tr>
    <tr>
      <td style="border: 1px solid #000; padding: 6px;">Supplier Name</td>
      <td style="border: 1px solid #000; padding: 6px;">Receiving Warehouse</td>
      <td style="border: 1px solid #000; padding: 6px;">Recipient Sector</td>
      <td style="border: 1px solid #000; padding: 6px;">Sector Number</td>
    </tr>
    <tr>
      <td style="border: 1px solid #000; padding: 6px;">Document Date</td>
      <td style="border: 1px solid #000; padding: 6px;">Document No.</td>
      <td style="border: 1px solid #000; padding: 6px;">Based on Document</td>
      <td style="border: 1px solid #000; padding: 6px;"></td>
    </tr>
  </table>

  <!-- Items Table -->
  <table style="width: 100%; border-collapse: collapse;" class="table table-bordered">
    <thead class="table-secondary">
      <tr>
        <th rowspan="2" style="border: 1px solid #000; padding: 6px;">Count</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 6px;">Item No.</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 6px;">Item Name / Description*</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 6px;">Unit of Measure</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 6px;">Quantity</th>
        <th colspan="2" style="border: 1px solid #000; padding: 6px;">Unit Price</th>
        <th colspan="2" style="border: 1px solid #000; padding: 6px;">Total Price</th>
        <th rowspan="2" style="border: 1px solid #000; padding: 6px;">Comments</th>
      </tr>
      <tr>
        <th style="border: 1px solid #000; padding: 6px;">هـ</th>
        <th style="border: 1px solid #000; padding: 6px;">ر.س</th>
        <th style="border: 1px solid #000; padding: 6px;">هـ</th>
        <th style="border: 1px solid #000; padding: 6px;">ر.س</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border: 1px solid #000; padding: 6px;">1</td>
        <td style="border: 1px solid #000; padding: 6px;">123456</td>
        <td style="border: 1px solid #000; padding: 6px;">ميزان حرارة</td>
        <td style="border: 1px solid #000; padding: 6px;">علبة</td>
        <td style="border: 1px solid #000; padding: 6px;">20</td>
        <td style="border: 1px solid #000; padding: 6px;">5</td>
        <td style="border: 1px solid #000; padding: 6px;">10</td>
        <td style="border: 1px solid #000; padding: 6px;">100</td>
        <td style="border: 1px solid #000; padding: 6px;">200</td>
        <td style="border: 1px solid #000; padding: 6px;">جيد</td>
      </tr>
      <!-- Additional rows can be added here -->
    </tbody>
  </table>

  <!-- Total Price Row -->
  <div style="margin-top: 10px; font-weight: bold;">
    القيمة الإجمالية - Total Price:
  </div>

  <!-- Footer Section -->
  <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <tr>
      <td style="border: 1px solid #000; text-align: center; padding: 10px;">
        رئيس المسؤول<br>Chief Responsible<br><br>......................
      </td>
      <td style="border: 1px solid #000; text-align: center; padding: 10px;">
        العضو الفني<br>Technical Member*<br><br>......................
      </td>
      <td style="border: 1px solid #000; text-align: center; padding: 10px;">
        المستلم<br>Recipient<br><br>......................
      </td>
    </tr>
  </table>

  <!-- Approval Note -->
  <div style="text-align: center; margin-top: 15px; font-weight: bold; color: green;">
    معتمد - Approved
  </div>

  <!-- Signature and Date -->
  <div style="margin-top: 10px;">
    الاسم: _____________ <br>
    التوقيع: _____________ <br>
    التاريخ: _____________ <br>
    Name, Signature, Date (of approval)
  </div>

</div> *@